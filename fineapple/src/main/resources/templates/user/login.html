<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="index/toolbar :: head">
<meta charset="utf-8">
</head>
<body>
   <div id="loginModal" class="modal fade" role="dialog" th:fragment ="hong">      
   <div  class="modal-dialog " style="width:470px; height:1300px;">
    <div class="modal-content">
      <h1 class="modal-title" align="center"></h1>
     <div class="modal-header">
     </div>
     
        <div class="modal-body" style="height:500px; width:400px;">
<script src = "https://developers.kakao.com/sdk/js/kakao.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
$(function(){
   $("#userId").focus();
   
   $("#login").on("click",function(){
      var userId = $("#userId").val();
      var password =$("#password").val();
      console.log(userId);
      console.log(password);
      
      if(userId == null || userId.length< 1){
         alert("ID를 입력해주세요.")
         $("#userId").focus();
         return;
      }
      
      if(password == null || password.length< 1){
         alert("비밀번호를 입력해주세요.")
         $("#password").focus();
         return;
      }
      $("#loginform").attr("method","POST").attr("action","/user/login/redirect").submit();
   });   


});

$(function(){
   $("#join").on("click",function(){
      self.location = "/user/addUser";
   })
   
})

function kakaoLogin(){
window.Kakao.init("3255273f04f93853debcbfbac9b7ff4c");
   
   window.Kakao.Auth.login({
      scope:'profile_nickname, profile_image,account_email,gender',
      success : function(authObj){
         console.log(authObj);
         window.Kakao.API.request({
            url:'/v2/user/me',
            success:res => {      
               const kakao_account = res.kakao_account;
               console.log(kakao_account);
               var userId =kakao_account.email;
               var gender = kakao_account.gender;
               var userName = kakao_account.profile.nickname;
               var profile = kakao_account.profile.profile_image_url;
               console.log(userId);
               console.log(gender);
               console.log(profile);
               console.log(name);
               var data ={
                     userName :userName,
                     userId: userId,
                     gender : gender,
                     password : "kakaopassword"
               }
               $.ajax({
                  type:"POST",
                  url:"/user/checkDuplication/kakao",
                  data: JSON.stringify(data),
                  accept :"application/json",
                  contentType : "application/json",
                  success : function(map){
                     console.log("return : " + map.result)
                     var userId = map.user.userId;
                     var gender = map.user.gender;
                     var data ={
                           userId: userId,
                           gender : gender,
                           password : "kakaopassword"};
                     if(map.result == 0){
                        var userId = map.user.userId;
                        var gender = map.user.gender;
                        var data ={
                              userId: userId,
                              gender : gender,
                              userName: 'ㄹㄹㄹㄹ',
                              password : "kakaopassword"};
                        
                        $.ajax({
                           type :"POST",
                           url :"/user/addUser/kakao",
                           data : JSON.stringify(data),
                           accept:"application/json",
                           contentType : "application/json",
                        
                        }).done(function(user){
                           alert("첫로그인시 회원가입이 필요합니다.");
                  
                           $.ajax({
                              type :"POST",
                              url :"/user/addUser/rest",
                              data :JSON.stringify({userId : user.userId,
                                    gender : user.gender,
                                    password : "kakaopassword"}),
                              accept:"application/json",
                              contentType : "application/json",
                           }).done(function(user){
                              // alert("회원가입창으로 이동");
                              // $("#kakao #userId", "#kakao #gender, #kakao #password").attr("method","POST")
                               window.location="/user/addUser?userId="+userId;
                           })
                           
                        });
                        
                     }else {
                        var data = {
                           userId : map.user.userId,
                           password : "kakaopassword"
                        }
                        $.ajax({
                           type :"POST",
                           url :"user/login/kakao",
                           data : JSON.stringify(data),
                           accept : "application/json",
                           contentType : "application/json"
                        }).done(function(data){
                           console.log("kakaologin");
                           window.location="/"
                           
                        });
                     }
                     
                  }
                  
            
                  
               });
         
               }
            
         
            
   
         });
         
         
      }

      
   })

}
</script>
<div align="center">
<div class="container show-grid" align="center" style="width: 450px; padding:0px; margin: 0px;" >

<br>

<h1 class="fs-2tx fw-bolder mb-8">
<span class="d-inline-block position-relative ms-2">
<span class="d-inline-block mb-2">Login</span>
<span class="d-inline-block position-absolute h-8px bottom-0 end-0 start-0 bg-success translate rounded"></span>
</span></h1>
<br>
<form id="loginform">
    <input type="text" id="userId" name="userId" class="form-control form-control-solid" placeholder="UserId"/>

<br>
<div class="mb-10">
    <input type="password" class="form-control form-control-solid" placeholder="Password" id="password"  name="password"/>
</div>
</form>
<br>
<div align="center">
<input type="button" id = "login" name="login" data-text-content="true" style="border : none; padding : 0; font-size: 17px; color: rgb(255, 255, 255); text-align: center; line-height: 2.5em; border-radius: 4px; background-color: rgba(241, 196, 15, 0.71);  width: 300px; height: 40px;" value = "Login">
</div>
<br>
<div align="center">
<input type = "button" value ="Join" id="join"  data-text-content="true" style="font-size: 17px; color: rgb(64, 64, 64); text-align: center; line-height: 2.5em; border:none ; padding:0; background-color: rgba(224, 224, 224, 0.71);  width: 300px; height: 40px;">
</div>
<br>
<a th:onClick="|location.href='@{../user/getUserList}'|" class="btn btn-lg btn-flex btn-link btn-color-success" id="getUserList" name="getUserList">Find Id
													<!--begin::Svg Icon | path: icons/duotune/arrows/arr064.svg-->
													<span class="svg-icon ms-2 svg-icon-3">
														<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
															<rect opacity="0.5" x="18" y="13" width="13" height="2" rx="1" transform="rotate(-180 18 13)" fill="black"></rect>
															<path d="M15.4343 12.5657L11.25 16.75C10.8358 17.1642 10.8358 17.8358 11.25 18.25C11.6642 18.6642 12.3358 18.6642 12.75 18.25L18.2929 12.7071C18.6834 12.3166 18.6834 11.6834 18.2929 11.2929L12.75 5.75C12.3358 5.33579 11.6642 5.33579 11.25 5.75C10.8358 6.16421 10.8358 6.83579 11.25 7.25L15.4343 11.4343C15.7467 11.7467 15.7467 12.2533 15.4343 12.5657Z" fill="black"></path>
														</svg>
													</span>
													<!--end::Svg Icon--></a>

<br>
<a th:onClick="|location.href='@{../user/findPassword}'|" class="btn btn-lg btn-flex btn-link btn-color-success" id ="findPassword" name="findPassword" >Change Password
													<!--begin::Svg Icon | path: icons/duotune/arrows/arr064.svg-->
													<span class="svg-icon ms-2 svg-icon-3">
														<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
															<rect opacity="0.5" x="18" y="13" width="13" height="2" rx="1" transform="rotate(-180 18 13)" fill="black"></rect>
															<path d="M15.4343 12.5657L11.25 16.75C10.8358 17.1642 10.8358 17.8358 11.25 18.25C11.6642 18.6642 12.3358 18.6642 12.75 18.25L18.2929 12.7071C18.6834 12.3166 18.6834 11.6834 18.2929 11.2929L12.75 5.75C12.3358 5.33579 11.6642 5.33579 11.25 5.75C10.8358 6.16421 10.8358 6.83579 11.25 7.25L15.4343 11.4343C15.7467 11.7467 15.7467 12.2533 15.4343 12.5657Z" fill="black"></path>
														</svg>
													</span>
													<!--end::Svg Icon--></a>

<div align = "center">
<br>

<a href= "javascript:kakaoLogin();"><img src = "../assets/img/kakao_login_medium_narrow.png"></a>

</div>
</div>
</div>
</div>
</div>
</div>
 <div class="modal-footer" >
     <button type="button" class="btn btn-default" data-bs-dismiss="modal">이전</button>
     </div>
    </div>
 
  


</body>
</html>